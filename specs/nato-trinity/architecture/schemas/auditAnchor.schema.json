{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://cyber-workbench.local/schemas/auditAnchor.schema.json",
  "title": "AuditAnchor",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "anchorVersion",
    "orgId",
    "generatedAt",
    "generatedBy",
    "riskHeadHash",
    "caseHeadHash",
    "auditEventsHash",
    "anchorHash"
  ],
  "properties": {
    "anchorVersion": { "type": "string", "const": "1.0" },
    "orgId": { "type": "string", "minLength": 1 },
    "generatedAt": { "type": "string", "format": "date-time" },
    "generatedBy": { "type": "string", "minLength": 1 },

    "riskHeadHash": { "type": "string", "minLength": 1 },
    "caseHeadHash": { "type": "string", "minLength": 1 },
    "auditEventsHash": { "type": "string", "minLength": 1 },

    "anchorHash": {
      "type": "string",
      "description": "SHA-256 (hex) of the canonical JSON payload of this anchor excluding signature and excluding anchorHash.",
      "pattern": "^[0-9a-fA-F]{64}$"
    },

    "signature": {
      "type": "object",
      "additionalProperties": false,
      "required": ["keyId", "alg", "value"],
      "properties": {
        "keyId": { "type": "string", "minLength": 1 },
        "alg": { "type": "string", "const": "ed25519" },
        "value": {
          "type": "string",
          "description": "Base64 signature of the canonical JSON payload (same payload used for anchorHash)."
        }
      }
    }
  }
}
